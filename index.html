<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta property="og:title" content="Dietética Axel y Javi" />
    <meta property="og:description" content="🛵 Te llevamos el pedido a tu casa" />
    <meta property="og:image" content="https://dieteticaaxelyjavi.github.io/img/logo.png" />
    <meta property="og:url" content="https://dieteticaaxelyjavi.github.io/" />
    <meta property="og:type" content="website" />
    <title>Dietética Axel y Javi</title>
    <link rel="icon" type="image/png" href="img/almendras.png"/>
    <link rel="stylesheet" href="css/estilos.css">
</head>
<body>

<!-- Encabezado con logo -->
<header class="header">
    <img src="img/logo.png" alt="Logo de la Dietética Axel y Javi" class="logo">
</header>

<!-- Filtro de búsqueda -->
<div class="filter-container">
    <div class="filter-input-wrapper">
        <input type="text" id="filter-input" placeholder="Buscar..." autocomplete="off">
        <span id="clear-filter">&times;</span>
    </div>

    <div class="tags-container" id="tags-container"></div>
</div>

<!-- Lista de productos -->
<ul class="productos-lista"></ul>

<!-- Botón flotante de WhatsApp -->
<a href="https://api.whatsapp.com/send/?phone=5491133417868" class="fab" target="_blank"
   aria-label="Enviar mensaje por WhatsApp">
    <img src="img/whatsapp.png" alt="Icono de WhatsApp">
</a>

<!-- Scripts -->
<script src="js/main.js"></script>

<script>
document.addEventListener("contextmenu", function(e){
  e.preventDefault();
}, false);
</script>

<script>
document.addEventListener('DOMContentLoaded', () => {
    cargarEtiquetasDesdeCSV();
});

async function cargarEtiquetasDesdeCSV() {
    const urlCSV = 'https://raw.githubusercontent.com/dieteticaaxelyjavi/productos/main/etiquetas';
    try {
        const respuesta = await fetch(urlCSV);
        const texto = await respuesta.text();

        const lineas = texto.trim().split('\n');
        const etiquetas = lineas.map(l => l.trim());

        const contenedor = document.getElementById('tags-container');
        contenedor.innerHTML = '';

        etiquetas.forEach(etiqueta => {
            const boton = document.createElement('button');
            boton.className = 'tag';
            boton.textContent = etiqueta;
            contenedor.appendChild(boton);
        });

        inicializarEventosTags();

    } catch (error) {
        console.error('Error al cargar las etiquetas:', error);
    }
}

function inicializarEventosTags() {
    const tagsContainer = document.querySelector('.tags-container');
    const inputFiltro = document.getElementById('filter-input');

    // Eliminar botón toggle anterior si existiera (por recarga o reinicialización)
    const oldToggle = document.getElementById('toggle-tags');
    if (oldToggle) oldToggle.remove();

    // Recolectar las tags (excluyendo el botón toggle si existía)
    const allTags = Array.from(tagsContainer.querySelectorAll('.tag')).filter(tag => tag.id !== 'toggle-tags');

    // Crear botón toggle
    const toggleBtn = document.createElement('button');
    toggleBtn.className = 'tag toggle-tag';
    toggleBtn.textContent = '+';
    toggleBtn.id = 'toggle-tags';
    tagsContainer.appendChild(toggleBtn);

    // Esperar al siguiente frame para que el layout esté listo
    requestAnimationFrame(() => {
        const baseTop = allTags[0]?.offsetTop ?? 0;
        const visibles = [];
        const ocultos = [];

        allTags.forEach(tag => {
            if (tag.offsetTop === baseTop) {
                visibles.push(tag);
                tag.style.display = 'inline-block';
            } else {
                ocultos.push(tag);
                tag.style.display = 'none';
            }
        });

        // Mostrar el botón toggle solo si hay ocultos
        toggleBtn.style.display = ocultos.length > 0 ? 'inline-block' : 'none';

        // Evento del botón toggle
        toggleBtn.addEventListener('click', () => {
            const ocultosVisibles = ocultos[0].style.display === 'none';
            ocultos.forEach(tag => tag.style.display = ocultosVisibles ? 'inline-block' : 'none');
            toggleBtn.textContent = ocultosVisibles ? '-' : '+';
        });

        // Evento de click en cada tag
        allTags.forEach(tag => {
            tag.addEventListener('click', () => {
                inputFiltro.value = inputFiltro.value === tag.textContent ? '' : tag.textContent;
                filtrarProductos();

                // Al hacer click en un tag, se colapsan los ocultos si estaban abiertos
                if (ocultos.length && ocultos[0].style.display !== 'none') {
                    ocultos.forEach(tag => tag.style.display = 'none');
                    toggleBtn.textContent = '+';
                }
            });
        });
    });
}

</script>

</body>
</html>
